#!/bin/bash -eu

source $OPENSHIFT_CARTRIDGE_SDK_BASH

case "$1" in
  -v|--version)
    version="$2"
esac

# Create additional directories required by the diy cartridge
mkdir -p ${OPENSHIFT_WEBRATIO_DIR}run
cd $OPENSHIFT_REPO_DIR

client_result "installing tomcat"
wget http://apache.fastbull.org/tomcat/tomcat-7/v7.0.54/bin/apache-tomcat-7.0.54.tar.gz
tar -xzf apache-tomcat-7.0.54.tar.gz
rm -rf apache-tomcat-7.0.54.tar.gz
cd apache-tomcat-7.0.54/conf
rm -rf server.xml.erb
mv -rf ${OPENSHIFT_REPO_DIR}/diy/server.xml.erb ${OPENSHIFT_REPO_DIR}/apache-tomcat-7.0.54/conf
cd ${OPENSHIFT_REPO_DIR}/apache-tomcat-7.0.54/bin
chmod 775 catalina.sh
chmod 775 startup.sh
chmod 775 shutdown.sh
client_result "tomcat succesfully installed"

client_result "Disclaimer: This is an experimental cartridge that provides a way to try unsupported languages, frameworks, and middleware on OpenShift."
